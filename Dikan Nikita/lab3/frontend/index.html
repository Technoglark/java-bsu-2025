<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Debt Tracker</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f4f9; display: flex; justify-content: center; }
        .container { width: 800px; background: white; padding: 30px; margin-top: 50px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #333; }

        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input, select { padding: 10px; border: 1px solid #ddd; border-radius: 5px; flex: 1; }
        button#add-btn { background: #28a745; color: white; border: none; cursor: pointer; padding: 10px 20px; font-weight: bold; border-radius: 5px;}
        button#add-btn:hover { background: #218838; }

        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; }

        .done-true { text-decoration: line-through; color: #888; background: #e9ecef; }

        .action-btn { cursor: pointer; border: none; padding: 5px 10px; border-radius: 3px; color: white; }
        .btn-check { background: #007bff; margin-right: 5px;}
        .btn-delete { background: #dc3545; }
    </style>
</head>
<body>
<div class="container">
    <h2>üî• Student Debt Tracker üî•</h2>

    <div class="input-group">
        <input type="text" id="subject" placeholder="–ü—Ä–µ–¥–º–µ—Ç (–Ω–∞–ø—Ä. OOP)">
        <input type="text" id="desc" placeholder="–ß—Ç–æ —Å–¥–∞—Ç—å? (–Ω–∞–ø—Ä. –õ–∞–±–∞ 1)">
        <select id="diff">
            <option value="EASY">–ò–∑–∏</option>
            <option value="MEDIUM">–ù–æ—Ä–º</option>
            <option value="HARD">–°–ª–æ–∂–Ω–æ</option>
            <option value="NIGHTMARE">–ì—Ä–æ–±</option>
        </select>
        <button id="add-btn" onclick="addTask()">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>

    <table>
        <thead>
        <tr>
            <th>–ü—Ä–µ–¥–º–µ—Ç</th>
            <th>–ó–∞–¥–∞—á–∞</th>
            <th>–°–ª–æ–∂–Ω–æ—Å—Ç—å</th>
            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
        </tr>
        </thead>
        <tbody id="task-list">
        </tbody>
    </table>
</div>

<script>
    const API = 'http://localhost:8080/api/tasks';

    async function loadTasks() {
        const res = await fetch(API);
        const tasks = await res.json();
        const tbody = document.getElementById('task-list');
        tbody.innerHTML = ''; // –û—á–∏—Å—Ç–∫–∞

        tasks.forEach(task => {
            const row = document.createElement('tr');
            if (task.done) row.classList.add('done-true');

            row.innerHTML = `
                <td>${task.subject}</td>
                <td>${task.description}</td>
                <td><b>${task.difficulty}</b></td>
                <td>
                    ${!task.done ? `<button class="action-btn btn-check" onclick="completeTask(${task.id})">–°–¥–∞–ª</button>` : '‚úÖ'}
                    <button class="action-btn btn-delete" onclick="deleteTask(${task.id})">üóë</button>
                </td>
            `;
            tbody.appendChild(row);
        });
    }

    async function addTask() {
        const subject = document.getElementById('subject').value;
        const description = document.getElementById('desc').value;
        const difficulty = document.getElementById('diff').value;

        if(!subject || !description) return alert("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!");

        await fetch(API, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ subject, description, difficulty })
        });

        // –û—á–∏—Å—Ç–∫–∞ –ø–æ–ª–µ–π –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
        document.getElementById('subject').value = '';
        document.getElementById('desc').value = '';
        loadTasks();
    }

    async function completeTask(id) {
        await fetch(`${API}/${id}/done`, { method: 'PATCH' });
        loadTasks();
    }

    async function deleteTask(id) {
        if(confirm('–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å?')) {
            await fetch(`${API}/${id}`, { method: 'DELETE' });
            loadTasks();
        }
    }

    loadTasks();
</script>
</body>
</html>