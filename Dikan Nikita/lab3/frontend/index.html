<!DOCTYPE html>
<html lang="ru" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Debt Tracker 3000</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: #e2e8f0; }
        .card { border: none; background-color: #1e293b; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); transition: transform 0.2s; }
        .card:hover { transform: translateY(-2px); }
        .btn-success-custom { background: linear-gradient(135deg, #10b981, #059669); border: none; }
        .btn-danger-custom { background: linear-gradient(135deg, #ef4444, #dc2626); border: none; }

        .badge-EASY { background-color: #10b981; color: white; }
        .badge-MEDIUM { background-color: #3b82f6; color: white; }
        .badge-HARD { background-color: #f59e0b; color: black; }
        .badge-NIGHTMARE {
            background: linear-gradient(45deg, #7f1d1d, #ef4444);
            color: white;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        .task-done { text-decoration: line-through; opacity: 0.5; filter: grayscale(100%); }
        .progress { height: 25px; background-color: #334155; border-radius: 15px; }
        .progress-bar { background: linear-gradient(90deg, #3b82f6, #8b5cf6); font-weight: bold; }

        .floating-add { position: fixed; bottom: 30px; right: 30px; border-radius: 50%; width: 60px; height: 60px; font-size: 24px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); z-index: 100; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-transparent pt-4">
    <div class="container">
        <a class="navbar-brand fw-bold fs-3" href="#">
            <i class="fa-solid fa-graduation-cap text-primary"></i> DebtTracker <span class="text-muted fs-6"></span>
        </a>
        <button class="btn btn-outline-light btn-sm" onclick="toggleTheme()">
            <i class="fa-solid fa-moon"></i> / <i class="fa-solid fa-sun"></i>
        </button>
    </div>
</nav>

<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card p-4">
                <h5 class="text-muted mb-3">–ü—Ä–æ–≥—Ä–µ—Å—Å –≤—ã–∂–∏–≤–∞–Ω–∏—è</h5>
                <div class="progress position-relative">
                    <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%">0%</div>
                </div>
                <div class="d-flex justify-content-between mt-2 text-small">
                    <span id="stats-total">–í—Å–µ–≥–æ –¥–æ–ª–≥–æ–≤: 0</span>
                    <span id="stats-done" class="text-success">–°–¥–∞–Ω–æ: 0</span>
                </div>
            </div>
        </div>
    </div>

    <div id="task-container" class="row g-3">
        <div class="col-12 text-center py-5">
            <div class="spinner-border text-primary" role="status"></div>
            <p class="mt-2">–ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–≤–æ–∏ –ø—Ä–æ–±–ª–µ–º—ã...</p>
        </div>
    </div>
</div>
<button class="btn btn-primary floating-add" data-bs-toggle="modal" data-bs-target="#addTaskModal">
    <i class="fa-solid fa-plus"></i>
</button>

<div class="modal fade" id="addTaskModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content" style="background-color: #1e293b; color: white;">
            <div class="modal-header border-secondary">
                <h5 class="modal-title">–ù–æ–≤—ã–π –¥–æ–ª–≥</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">–ü—Ä–µ–¥–º–µ—Ç</label>
                    <input type="text" class="form-control bg-dark text-white border-secondary" id="subject" placeholder="–ù–∞–ø—Ä. –ê–ª–≥–æ—Ä–∏—Ç–º—ã">
                </div>
                <div class="mb-3">
                    <label class="form-label">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                    <input type="text" class="form-control bg-dark text-white border-secondary" id="desc" placeholder="–ù–∞–ø—Ä. –ö—É—Ä—Å–æ–≤–∞—è —Ä–∞–±–æ—Ç–∞">
                </div>
                <div class="mb-3">
                    <label class="form-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å</label>
                    <select class="form-select bg-dark text-white border-secondary" id="diff">
                        <option value="EASY">üü¢ –ò–∑–∏ (EASY)</option>
                        <option value="MEDIUM">üîµ –ù–æ—Ä–º (MEDIUM)</option>
                        <option value="HARD">üü† –ü–æ—Ç–Ω–æ (HARD)</option>
                        <option value="NIGHTMARE">üî¥ –ì–†–û–ë (NIGHTMARE)</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer border-secondary">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">–û—Ç–º–µ–Ω–∞</button>
                <button type="button" class="btn btn-primary" onclick="addTask()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const API_URL = 'http://localhost:8080/api/tasks';

    function toggleTheme() {
        const html = document.documentElement;
        const current = html.getAttribute('data-bs-theme');
        html.setAttribute('data-bs-theme', current === 'dark' ? 'light' : 'dark');
        if(current === 'dark') {
            document.body.style.backgroundColor = '#f1f5f9';
            document.body.style.color = '#0f172a';
            document.querySelectorAll('.card').forEach(c => c.style.backgroundColor = 'white');
        } else {
            document.body.style.backgroundColor = '#0f172a';
            document.body.style.color = '#e2e8f0';
            document.querySelectorAll('.card').forEach(c => c.style.backgroundColor = '#1e293b');
        }
    }

    async function loadTasks() {
        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error('Network response was not ok');
            const tasks = await response.json();
            render(tasks);
        } catch (e) {
            document.getElementById('task-container').innerHTML = `
                <div class="col-12 text-center text-danger mt-5">
                    <h3><i class="fa-solid fa-triangle-exclamation"></i> –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</h3>
                    <p>–ë—ç–∫–µ–Ω–¥ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç. –ü—Ä–æ–≤–µ—Ä—å, –∑–∞–ø—É—â–µ–Ω –ª–∏ Docker!</p>
                </div>`;
        }
    }

    function render(tasks) {
        const container = document.getElementById('task-container');
        container.innerHTML = '';

        const total = tasks.length;
        const done = tasks.filter(t => t.done).length;
        const percent = total === 0 ? 0 : Math.round((done / total) * 100);

        document.getElementById('progress-bar').style.width = `${percent}%`;
        document.getElementById('progress-bar').innerText = `${percent}%`;
        document.getElementById('stats-total').innerText = `–í—Å–µ–≥–æ –∑–∞–¥–∞—á: ${total}`;
        document.getElementById('stats-done').innerText = `–ì–æ—Ç–æ–≤–æ: ${done}`;

        if (tasks.length === 0) {
            container.innerHTML = `
            <div class="col-12 text-center py-5 text-muted">
                <i class="fa-solid fa-mug-hot fa-4x mb-3"></i>
                <h4>–î–æ–ª–≥–æ–≤ –Ω–µ—Ç!</h4>
                <p>–ú–æ–∂–Ω–æ –ø–æ–ø–∏—Ç—å –∫–æ—Ñ–µ –∏ —Ä–∞—Å—Å–ª–∞–±–∏—Ç—å—Å—è.</p>
            </div>`;
            return;
        }

        tasks.forEach(task => {
            const diffBadge = {
                'EASY': '<span class="badge badge-EASY"><i class="fa-solid fa-feather"></i> Easy</span>',
                'MEDIUM': '<span class="badge badge-MEDIUM"><i class="fa-solid fa-layer-group"></i> Medium</span>',
                'HARD': '<span class="badge badge-HARD"><i class="fa-solid fa-fire"></i> Hard</span>',
                'NIGHTMARE': '<span class="badge badge-NIGHTMARE"><i class="fa-solid fa-skull"></i> NIGHTMARE</span>'
            };

            const cardHtml = `
            <div class="col-md-6 col-lg-4">
                <div class="card h-100 ${task.done ? 'border-success' : ''}">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            ${diffBadge[task.difficulty]}
                            ${task.done ? '<span class="text-success"><i class="fa-solid fa-check-circle"></i> –°–¥–∞–Ω–æ</span>' : ''}
                        </div>
                        <h5 class="card-title fw-bold ${task.done ? 'task-done' : ''}">${task.subject}</h5>
                        <p class="card-text text-muted mb-4 ${task.done ? 'task-done' : ''}">${task.description}</p>

                        <div class="mt-auto d-flex gap-2">
                            ${!task.done ? `
                            <button onclick="completeTask(${task.id})" class="btn btn-success-custom text-white flex-grow-1">
                                <i class="fa-solid fa-check"></i> –°–¥–∞—Ç—å
                            </button>` : ''}
                            <button onclick="deleteTask(${task.id})" class="btn btn-outline-danger">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>`;
            container.innerHTML += cardHtml;
        });
    }

    async function addTask() {
        const subject = document.getElementById('subject').value;
        const description = document.getElementById('desc').value;
        const difficulty = document.getElementById('diff').value;

        if(!subject || !description) return alert("–ó–∞–ø–æ–ª–Ω–∏ –ø–æ–ª—è!");

        await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ subject, description, difficulty })
        });
        document.getElementById('subject').value = '';
        document.getElementById('desc').value = '';
        const modal = bootstrap.Modal.getInstance(document.getElementById('addTaskModal'));
        modal.hide();

        loadTasks();
    }

    async function completeTask(id) {
        await fetch(`${API_URL}/${id}/done`, { method: 'PATCH' });
        loadTasks();
    }

    async function deleteTask(id) {
        if(confirm('–¢–æ—á–Ω–æ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?')) {
            await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
            loadTasks();
        }
    }

    loadTasks();
</script>
</body>
</html>
